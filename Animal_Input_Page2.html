<!DOCTYPE html>
<html lang="EN" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>
            I B I S - Animal Input Form
        </title>
        <script type="text/javascript" src="jquery-1.11.3.js"> </script>
        <script type="text/javascript" src="http://127.0.0.1/ibis/fileselect.js"></script>
	
	<script type="text/javascript">
		$(document).ready(function(){
	 	 	$('#mediaPic').change(handleFileSelect);	
	 	 	 if (sessionStorage.userRef){
	 	 	 sessVar = sessionStorage.userRef;
	 	 	 //alert(sessVar);
	 	 	 sesA = sessVar.split(":");
	 	 	 conID = sesA[1];
	 	 	// alert(conID);
	 	 	 $('#contrib_ID').val(conID);
	 	 	 }else {
	    alert("You should really not be on this page!")
	    document.location = "IBIS_main2.html";
	    }
	 	}) 
	 	

	</script>
	<link rel="stylesheet"
        type="text/css"
        href="./AnimInput.css"
  >
    </head>
   <body name="AnimInputBody" onload="checkStorage()" >
   <div id="lookupdiv" style="display:none;"></div>
      <div id="allContainer">
       
        <div name="Heading">
	        <img id="logo_image" src="./images/Logo1_fullsizetransp.png">
            <p id="headingText">Animal Input Form</p>
        </div>
        
        <div id="pgButtons" class="littleDD">
        	<input type="button" value="Submit Data" class="buttonclass littleDD" onclick="doSubmit()">   
         <a href="IBIS_main2.html" class="buttonclass littleDD"><img src="" alt="">Back to Main Screen</a>
        <input type="button" id="lookupList" class="buttonclass littleDD" onclick="loadList()" value="Load Lookup List" />
        <input type="button" id="lookupHide" class="buttonclass littleDD" onclick="hideList()" value="Hide Lookup List" style="display : none;" />
        </div>
  
        <div id="detail_fs_min" class="littleDD" ">
          <div id="headinglist" class="littleDD">
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Phylum</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">subPhylum</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Class</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">subClass</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Order</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">subOrder</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Family</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">subFamily</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Genus</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">subGenus</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Species</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">subSpecies</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Common_Names</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Name_Notes</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Description</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Ecology</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Distrib_Notes</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Habits</label></p>
            <p><label class="thisareaLabel littleDD" onclick="loadcontent(this)">Status</label></p>
          </div> 
          
          <div id="outputBlock" class="bigDD outputblock">
            <p id="inputHeading">Enter Information</p>
            <textarea id="outputBox" class="littleDD outputbox"></textarea><br>
            <a id="sendeditButton" class="buttonclass littleDD" onclick="sendedit()" >Send</a>
         </div> 
                
        <form  name="AnimForm" action="../../cgi-bin/IBISCollectDataAnim.php3" method="POST" enctype="multipart/form-data" class="">
	  			<fieldset id="dataForm" class="hiddentext">
				    <input type="text" name="Akingdom" value="Animalia" class="hiddentext"></input>
				    <input type="text" id="Phylum" name="Aphylum" class="hiddentext"></input>
				    <input type="text" id="subPhylum" name="AsubPhylum" class="hiddentext"></input>
				    <input type="text" id="Class" name="Aclass" class="hiddentext"></input>
				    <input type="text" id="subClass" name="AsubClass" class="hiddentext"></input>
						<input type="text" id="Order" name="Aorder" class="hiddentext"></input>
						<input type="text" id="subOrder" name="subOrder" class="hiddentext"></input>
						<input type="text" id="Family" name="Afamily" class="hiddentext"></input>
						<input type="text" id="subFamily" name="subFamily" class="hiddentext"></input>
						<input type="text" id="Genus" name="Agenus" class="hiddentext"></input>
						<input type="text" id="subGenus" name="subGenus" class="hiddentext"></input>
						<input type="text" id="Species" name="Aspecies" class="hiddentext" change="checkDuplicate()"></input>
						<input type="text" id="subSpecies" name="subSpecies" class="hiddentext"></input>
						<input type="text" id="Common_Names" name="Acommon_Names" class="hiddentext"></input>
						<textarea id="Name_Notes" name="Aname_Notes" class="hiddentext"></textarea>
						<textarea id="Status" name="status" class="hiddentext"></textarea>
						<textarea id="Description" name="Adescription" class="hiddentext"></textarea>
						<textarea id="Ecology" name="Aecology" class="hiddentext"></textarea>
						<textarea id="Habits" name="Ahabits" class="hiddentext"></textarea>
						<textarea id="Distrib_Notes" name="Adistrib_Notes" class="hiddentext"></textarea>
					  <textarea id="Image_Tags" name = "Aimg_Tags" class="hiddentext"></textarea>
						<input type="text" name="contributer_ID" id="contrib_ID" class="hiddentext">
						
						<div id="images" class="littleDD">
          		<p class="labelclass">Add Media</p>
	      			<input type="file" name="media[]" id="mediaPic" class="littleDD" multiple />
	      		</div>
	      		<div id="tagslist"></div>
	      		<div id="imgDisplay" class="littleDD"></div>
	      		<div id="optionsDsplay" class="littleDD" style="display : none;"></div> 	
	  			</fieldset>
	 			</form>
	 			<div id="messageDiv"></div>
	 			<div id="infoDiv"> <p>You have to add a tag for each picture<br>that you want to submit or weird things will happen.</p><p>Click on a picture to add a tag</p></div>  
	 		</div>
    </div> 
    <script>
    function loadList(){
          $("#lookupdiv").load("IBIS_animalia-tablestripped.html");
          $("#lookupdiv").css("display", "inline");
          $("lookupdiv > #dateTime").css("display", "none");
          $("#lookupList").css("display", "none");
          $("#lookupHide").css("display", "inline");
        }
        function hideList(){
        	$("#lookupdiv").css("display","none");
        	$("#lookupHide").css("display", "none");
          $("#lookupList").css("display", "inline");
        }
</script>
    
        <script type="text/javascript">
        var imgname = "";
        var theHeading = "";
	  		var theLabel ="";
	  		
	  		function addTag(){
        var tagslist = $('#mediatagsinput').val();
        var newtag = imgname +" : "+ tagslist;
        var listitem = "<input type=\"text\"name=\"imgtag[]\" class=\"listitemC littleDD\" value=\""+newtag+"\" ></input><br />";
        $('#infoDiv').hide();
        $('#tagslist').append(listitem);
        }
  
        function showOps(that){
		   	  imgname = that.title;
		   	  $("#optionsDsplay").slideDown('fast');
		   	  var opttext = '<p class="labelclass">Add Media Tags for <br>' + imgname + '</p><input type="text" name="AmediaTagsInput" id="mediatagsinput" class="littleDD inputclass" /\><br><input type="button" class="buttonclass" value="Add" onclick="addTag();" />';
		  		$('#optionsDsplay').html(opttext);
		  		
      }
    function checkDuplicate(){ 
    var matchList = "";
    alert("it is running the script");
	 	var speciesval= $('#Species').val();
		$.ajax({
			url : '../../cgi-bin/checkdup.php3',
			type : "get",
			async : "false",
			data :{species : speciesval},
			success : function(data){
				var testregexp = /nomatch/;
				if (testregexp.test(data)){
					alert("no matching species found");
				}else {
					var dataList = data.split(":");
					for (i=0; i<dataList.length; i++){
						if (dataList[i]==""){
							continue;
							}
						//	alert(dataList[i]);
					var	 matchList = '<li>' + dataList[i] + '</li>';
					}
			
				}
			}
		})
		var matchedDiv = "<div id=\"matches\">\
												<p>Possible duplicate species found.\
												Maybe you want to edit this existing record instead</p>\
												<ul>" + matchList + "</ul>\
												</div>";
		$('#messageDiv').html(matchedDiv);
}
        
	 function sendedit(){
	  var editval = $("#outputBox").val();
        $('#'+theHeading).val(editval);
        theLabel.style.backgroundColor = "pink";
        $("#outputBox").val("");
        if (theHeading == "Species"){
        checkDuplicate();
        }
     }
     
    function loadcontent(that){
        theHeading = $(that).text();
        theLabel = that;
        $('.thisareaLabel').css("color" ,"black");
        theLabel.style.color = "lightgreen";
        //theLabel.color = "red";
        var theContent = $('#'+theHeading).val();
        $("#outputBox").val(theContent);
     }
        
	function doSubmit(){
		//cleanupData();
		document.AnimForm.submit();
	}
  
     
      </script>
    </body>
</html>
